name: Publicar Noticias y Videos GungoTV
on:
  schedule:
    - cron: '0 */1 * * *'
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  actualizar_web:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.11' 
      - run: pip install google-genai 
      
      - run: python agente.py
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          
      - run: python agente_videos.py
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          
      - name: Crear Borrador para Revisi√≥n (Pull Request)
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.name 'Agente Gungo'
          git config --global user.email 'bot@gungo.com'
          
          RAMA="borrador-contenido-${{ github.run_id }}"
          git checkout -b $RAMA
          
          # AHORA GUARDA data.json CON NOTICIAS Y VIDEOS
          git add data.json
          git commit -m "Revisi√≥n requerida: Nuevo contenido (Noticia y Video) generado por IA"
          git push origin $RAMA
          
          gh pr create --title "üìù Revisi√≥n requerida: Nueva Noticia y Video Viral" --body "El equipo de agentes ha redactado una nueva noticia y cazado un video viral para GungoTV. Por favor, verifica los hechos y los enlaces. Si todo es correcto, aprueba este cambio para publicarlo en la web." --base main --head $RAMA
