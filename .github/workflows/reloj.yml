name: Publicar Noticias GungoTV
on:
  schedule:
    - cron: '0 */3 * * *'
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

jobs:
  actualizar_web:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-python@v4
        with:
          python-version: '3.11' 
      - run: pip install google-genai 
      - run: python agente.py
        env:
          GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
          
      - name: Crear Borrador para Revisi√≥n (Pull Request)
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          git config --global user.name 'Agente Gungo'
          git config --global user.email 'bot@gungo.com'
          
          RAMA="borrador-noticia-${{ github.run_id }}"
          git checkout -b $RAMA
          
          # AHORA GUARDA data.json EN LUGAR DE noticias.json
          git add data.json
          git commit -m "Revisi√≥n requerida: Nueva noticia generada por IA"
          git push origin $RAMA
          
          gh pr create --title "üìù Revisi√≥n requerida: Nueva Noticia" --body "El agente ha redactado una nueva noticia para Gungo. Por favor, verifica la veracidad de los hechos. Si todo es correcto, aprueba este cambio para publicarlo en la web." --base main --head $RAMA
